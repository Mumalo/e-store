<!--{% load bootstrap3 %}-->
{% load auction_tags %}
{% load notifications_tags %}
{% load auction_tags %}
{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{% block title %}{% endblock %}</title>


    {% block head %}
        <!--<link rel="stylesheet" type="text/css" href="{% static 'css/jquery.flipcountdown.css' %}" />-->
        <!--<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">-->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link href="{% static 'css/home.css' %}" rel="stylesheet" type="text/css">
        <!--<link rel="stylesheet" href="{% static 'css/flipclock.css' %}">-->
        {% include 'material/includes/material_css.html' %}
        <link  href="{% static 'css/owlcarousel/owl.carousel.min.css' %}" rel="stylesheet">
        <link  href="{% static 'css/owlcarousel/owl.theme.default.min.css' %}" rel="stylesheet">
        <!--<link href="{% static 'selectable/css/dj.selectable.css' %}" type="text/css" media="all" rel="stylesheet">-->

    {% block extrahead %}{% endblock %}
    {% endblock %}



</head>

<body>





<div class="main-header-container">
   <div class="navbar navbar-default" id="main-header" style="z-index: 3">
       <div class="container-fluid header-content">
           <div class="navbar-header">
               <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
               </button>
               <a class="navbar-brand text" href="{% url 'auctions:home' %}" style="color: #fff;"><img src="{% static 'images/background/logo.jpg' %}" class="img-responsive logo"><span class="logo-text">IA STORE</span></a>
           </div>

       <div class="collapse navbar-collapse" id="myNavbar">

           <ul class="nav navbar-nav">
               <!--<li><a href="{% url 'auctions:home' %}" class="text">Home</a></li>-->
               <!--<li><a href="#" class="text">About Us</a></li>-->


           </ul>

           <ul class="nav navbar-nav navbar-right right-header">

               {% if request.user.is_authenticated %}
                     {% register_notify_callbacks callbacks='fill_notification_list,fill_notification_badge' %}
                    {% notifications_unread as unread_count %}
                    <li class="dropdown pagination-centered">
                        <a href="#" class="dropdown-button notification-badge" data-activates="dropdown2" style="padding-left: 0; padding-right: 0" id="dLabel" role="button">
                            {% if unread_count > 0%}
                                <i class="glyphicon glyphicon-bell">
                                    <div class="notification-count text-center" style="color: #fff; background: #990000">{% live_notify_badge %}</div>
                                </i>
                            {% else %}
                                <i class="glyphicon glyphicon-bell">
                                    <div class="notification-count text-center" style="color: #333">{% live_notify_badge %}</div>
                                </i>
                            {% endif %}
                        </a>


                   <!--if there is an unread notification, show dropdown -->

                        <ul id="dropdown2" class="dropdown-content notifications" role="menu" aria-labelledby="dLabel">
                            <!--<div class="row"><a href="{% url 'notifications:mark_all_as_read' %}">mark all as read</a></div>-->
                            <div class="notification-heading">
                                <table style="border: none">
                                    <tr>
                                        <td><h6 class="menu-title">Notifications</h6></td>
                                        <td><h6 class="menu-title pull-right">View All <i class="glyphicon glyphicon-circle-arrow-right"></i> </h6></td>
                                    </tr>
                                </table>
                            </div>
                            <li class="divider"></li>

                                 <!-- left so for testing purposes -->
                                {% notifications_unread as unread_count %}
                                {% if unread_count %}
                                     {% for notification in user.notifications.unread %}
                                        <li class="notification-dropdown-li">
                                                <div class="row no-gutter" style="margin-bottom: 0px !important; margin-top: 0px !important;">
                                                    <div class="col-xs-2 col-md-2 col-sm-2">
                                                        {% if notification.actor.profile.photo %}
                                                            <img src="{{ notification.actor.profile.photo.url}}" class="img-responsive small-image">
                                                        {% else %}
                                                            <img src="{% static 'images/no_image.png' %}" class="img-responsive small-image">
                                                        {% endif %}
                                                        <p></p>
                                                    </div>

                                                    <div class="col-sm-10 col-xs-10 col-md-10">
                                                        <p>
                                                            <a href="#">{{ notification.actor}}</a>  {{ notification.verb }}
                                                             {{ notification.timesince }} ago
                                                        </p>

                                                    </div>

                                                </div>  <!-- end the div row -->
                                            </a>
                                        </li>
                                    {% endfor  %}
                                {% endif %}<!-- end if uncread_count -->
                        </ul>
               </li> <!-- end of notification -->

                     <li><a href="{% url 'auctions:list' %}" class="text">All Auctions</a></li>
                     <li><a href="{% url 'auctions:add_new_auction' %}" class="text">Add new auction<span class=""></span></a></li>
                     <!--<li class="ad"><a href="#"><button type="button" class="btn btn-primary btn-xs" href="#"  id="post-ad">Post Ad</button></a></li>-->
               {% else %}
                    <li><a href="{% url 'accounts:register' %}" class="text"><span class="glyphicon glyphicon-user"></span>Register</a></li>
                    <li><a href="{% url 'accounts:login' %}" class="profile-dropdown-li text"><span class="glyphicon glyphicon-log-in pull-right">Login</span></a>
               {% endif %}
               <!--<li><a href="#"><span class="glyphicon glyphicon-shopping-cart"></span>Shop</a></li>-->
             {% if request.user.is_authenticated %}

               <!--Drop down profile showing user's informaton -->


               <li>

               </li> <!-- user's profile photo -->
               <li class="list-unstyled" style="padding-left: 15px">
                     <a class='dropdown-button' href='#' data-activates='dropdown1' style="padding-left: 0; padding-right: 0">
                        <span class="glyphicon glyphicon-user" style="color: #F3DAA0;"></span>
                    </a>

                     <ul id="dropdown1" class="dropdown-content">
                            <li><a href="{{ user.get_absolute_url }}" class="profile-dropdown-li">User<span class="glyphicon glyphicon-user pull-right"></span></a></li>
                            <li><a href="{% url 'accounts:edit' request.user.pk %}" class="profile-dropdown-li">Profile settings<span class="glyphicon glyphicon-cog pull-right"></span></a></li>
                            <li><a href="{% url 'accounts:logout' %}" class="profile-dropdown-li"><span class="glyphicon glyphicon-log-out pull-right"></span>Logout</a></li>
                            <li><a href="#!" class="profile-dropdown-li">Items<span class="badge pull-right" style="color: #EDF3FE">{% total_auctions request.user %}</span></a></li>
                     </ul>
                </li>
             {% endif %} <!-- end user authenticated -->
           </ul>

       </div> <!-- end of nav-bar container -->

   </div>
   </div>
</div>
   <!--<div class="jumbotron sub-header">-->
        <!--<div class="row text-center" style="padding-top: -10px">-->
            <!--<h5 style="color: rgba(73, 31, 3, 0.85)"><span style="margin-right: 4px">IA</span> <span>STORE</span></h5>-->
        <!--</div>-->
    <!--</div>-->

<div class="search">
    <div class="navbar navbar-default search-box-container row">
       <div class="col-sm-1 col-md-1">

       </div>
       <div class="col-sm-10 col-md-10">
           <div class="row">
               <div class="col-xs-10 col-sm-10 col-md-10">
                   {% search_form %}
               </div>


           </div>



       </div>
       <div class="col-sm-1 col-md-1">

       </div>
   </div>
</div>



       {% block content %}

        {% endblock %}

   <footer class="container-fluid text-center">

       {% block js %}
            <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>-->
             <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
             <script src="{% static 'js/smart-selects/admin/js/chainedfk.js' %}"></script>
             <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
            {% include 'material/includes/material_js.html' %}

            <!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>-->
            <!--<script src="{% static 'material/js/jquery.js' %}"></script>-->



            <!--<script src="{% static 'js/countdown.js' %}"></script>-->
            <script src=" http://cdn.jsdelivr.net/jquery.cookie/1.4.1/jquery.cookie.min.js "></script>
            <script src="{% static 'notifications/notify.js' %}" type="text/javascript"></script>
            <script type="text/javascript" src="https://simplewebrtc.com/latest-v2.js"></script>
            <script src="{% static 'js/owlcarousel/owl.carousel.min.js' %}"></script>
            <!--<script>-->
                <!--var csrftoken = $.cookie('csrftoken');-->
                    <!--function csrfSafeMethod(method) {-->
                    <!--// these HTTP methods do not require CSRF protection-->
                    <!--return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));-->
                    <!--}-->
                    <!--$.ajaxSetup({-->
                    <!--beforeSend: function(xhr, settings) {-->
                    <!--if (!csrfSafeMethod(settings.type) && !this.crossDomain) {-->
                    <!--xhr.setRequestHeader("X-CSRFToken", csrftoken);-->
                    <!--}-->
                    <!--}-->
                    <!--});-->
            <!--</script>-->
            <script src="{% static 'js/home.js' %}"></script>
            <script>
                $(document).ready(function() {

                    $('#cat-select').on('change', function () {
                        var selectedopt = $(this).find('option:selected')
                        var selectedval = selectedopt.val()
                        var options = ''
                        var cat_name = selectedopt.text()

                        $.post("{% url 'auctions:select-by-category' %}",
                                {category: cat_name},
                                function (data) {

//                                    var json_data = $.parseJSON(data)


                                     $('#sub-cat-select').each(function(){
                                         $('#sub-cat-select option').remove()
                                     })
                                    for (i = data.length -1; i >= 0; i--){

//
                                        options += ('<option  value="' + data[i] + '">'+ data[i] + '</option>')

                                    }

                                  $('#sub-cat-select').append(options)
//
                                });

                    }).change()

                    $('.cat-list').hover(function(){
                         var el = $('#subcats');
                         var current_cat = $(this).data('action');
                         $(this).append(el)
                            el.css('display', 'inline-block')
                            el.css('position', 'absolute')
                            el.css('z-index', '3')
                    $.post("{% url 'auctions:subcats-for-cats' %}",
                        { cat:current_cat},
                        function(data) {
                            el.empty()
                            if (jQuery.isEmptyObject(data)){
                                el.css('display', 'none')
                            }
                            var items_array = []

                            for (val in data){
                                id_val = val
                                json_parsed_items = JSON.parse(data[val])
                                 var heads = $('<div class="col-md-4" id="' + id_val +'" style="color: white !important;"></div>')
                                 heads.append('<h6 style="border-bottom: 1px solid #337ab7; text-transform: capitalize">' + val + '</h6>')
                                 items_array.push(json_parsed_items)
                                 item_ids = val + 'item'
                                 el.append(heads)

                                 item = $('<div class="list-group row"  id="' + item_ids + '"></div>')


                                for (i in json_parsed_items ){
                                    item_key = json_parsed_items[i]["pk"]
                                    var url = "{% url 'auctions:bid' 12 %}".replace(12, item_key)
//                                    alert(url)
                                    link = $('<a class="" style="color: white !important; display: block; padding: 6px" href="' + url+ '" >'+ json_parsed_items[i]["fields"]["item"] + '</a>')
                                    item.append(link)
                                }

                                if (item.attr('id').includes(heads.attr('id'))){
                                    heads.append(item)
                                }


                            }





                    })

                    },
                        function(){
                            //$( this ).find( '.sub-cat-on-hover:last' ).remove();
                            $( this ).find( '#subcats' ).css('display', 'none')
                        }
                    );

//                    End of hover display function

                    $('.follow-button').click(function(e){
                        e.preventDefault
                        var id = $(this).data('id')
//                        alert(id)
//                        alert($(this).data('action'))
                        $.post('{% url "accounts:follow" %}',
                                {
                                    id: $(this).data('id'),
                                    action:$(this).data('action')

                                },

                                function(data){
//                                    alert(data['status'])
                                    if (data['status'] == 'ok'){
                                        var prev_action = $('.follow-button').data('action');

//                                        toggle action

                                        $('.follow-button').data('action',
                                        prev_action == 'follow' ? 'unfollow': 'follow')

//                                        Toggle the link text
                                        $('.follow-button').text(
                                                prev_action == 'follow' ? 'Unfollow': 'Follow'
                                        )

//                                        Update total followers

                                        var prev_followers = parseInt($('.followers-count .total-followers').text());
                                            $('.followers-count .total-followers').text(prev_action == 'follow' ?
                                            prev_followers + 1: prev_followers -1);
                                    }
                                }
                        )
                    })

//                    Initialize the modal plugin
                     $('.modal').modal({
                            dismissible: true, // Modal can be dismissed by clicking outside of the modal
                            opacity: .5, // Opacity of modal background
                            inDuration: 400, // Transition in duration
                            outDuration: 400, // Transition out duration
                            startingTop: '4%', // Starting top style attribute
                            endingTop: '10%',
                     });

                    function getCookie(name) {
                        var cookieValue = null;
                        var i = 0;
                        if (document.cookie && document.cookie !== '') {
                            var cookies = document.cookie.split(';');
                            for (i; i < cookies.length; i++) {
                                var cookie = jQuery.trim(cookies[i]);
                                // Does this cookie string begin with the name we want?
                                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }
                    var csrftoken = getCookie('csrftoken');

                    function csrfSafeMethod(method) {
                        // these HTTP methods do not require CSRF protection
                        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
                    }
                    $.ajaxSetup({
                        crossDomain: false, // obviates need for sameOrigin test
                        beforeSend: function(xhr, settings) {
                            if (!csrfSafeMethod(settings.type)) {
                                xhr.setRequestHeader("X-CSRFToken", csrftoken);
                            }
                        }
                    });
                })


            </script>


            {% block extrajs %}{% endblock %}

       <div class="footer-container">
           <div class="footer">
           <div class="footer-header">
                <a href="#main-header">Back to Top</a>
           </div>

       </div>
       </div>

       {% endblock %}
   </footer>
</body>
</html>