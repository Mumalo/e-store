{% extends "base.html" %}
{% load auction_tags %}
{% load static %}
{% block title %}{% endblock %}
{% block extrahead %}
    <link type="text/css" rel="stylesheet" href="{% static 'css/nouislider.min.css' %}" />
{% endblock %}

{% block content %}
<div class="container-fluid">
    <ul class="breadcrumb">
        <li><a href="{% url 'pages:home' %}">Home</a></li>
        <li><a href="{% url 'auctions:list' %}">items</a></li>

        {% if g_search != None or search != None %}
            <li><a href="#">Search</a></li>
            {% if g_search %}
                <li><a href="#"  style="font-weight: 800">{{gs_number}} items were found matching your query</a></li>
            {% elif search %}
                <li><a href="#"  style="font-weight: 800">{{s_number}} items were found matching your query</a></li>
            {% endif %}
        {% endif %}

        {% if gs_number == 0 or s_number == 0 %}
              <li>
                   <a href="{% url 'auctions:list' %}" style="font-weight: 800">0 items were found matching your query</a>
              </li>
        {% endif %}
    </ul>

    <div class="row">
        <div class="col-md-3 col-sm-3 white-background" id="aside">
            <div class="aside">
                <h3 class="aside-title">Filter By Price</h3>
                <div class="row">
                    <div class="col-xs-8 col-sm-8 col-md-8 price-slider-container">
                          <div id="price-slider"></div>
                    </div>
                    <div class="price-input col-xs-4 col-sm-4 col-md-4">
                        <form type="get" id="advanced_search_price">
                            {% csrf_token %}
                            <input type="hidden" name="sub_search">
                            {{ search_form.min }}
                            {{ search_form.max }}
                            <button type="submit" class="main-btn btn icon-btn" id="advanced-search-submit" name="sub_search" value="submit2">
                                <i class="fa fa-arrow-down"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>

             <div class="aside">
                <h3 class="aside-title">Filter by Key Word</h3>
                <div class="key-input">
                    <form type="get">
                        <div class="row no-gutter">
                            <div class="col-xs-9 col-sm-9 col-md-9 col-xs-6 advanced-search-key">
                                {{ search_form.key }}
                            </div>
                            <div class="col-xs-3 col-sm-3 col-md-3 col-xs-6 advanced-search-button">
                                <button type="submit" class="main-btn btn icon-btn" id="advanced-search-submit" name="sub_search" value="submit2">
                                    <i class="fa fa-arrow-down"></i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="aside aside-categories">
                <h3 class="aside-title">Categories</h3>
                <ul class="list-links">
                    {%  product_categories as categories %}
                    {% for c in categories %}
                        <li><a href="{% url 'auctions:category_detail' category_id=c.id category_slug=c.slug %}">{{ c }}</a></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
            <!--Call the template tage here to render items -->
        <div class="col-md-9 col-sm-9 white-background products-container">
            <div class="store-filter clearfix">
                <div class="pull-left">
                    <div class="row-filter">
                        <a href="#" id="grid"><i class="fa fa-th-large"></i></a>
                        <a href="#" class="active" id="list"><i class="fa fa-bars"></i></a>
                    </div>
                    <div class="sort-filter" style="display: inline-block">
                        <form method="get" name="filter_search" id="search_filter">
                            {% csrf_token %}
                            {{ filter_form }}
                        </form>
                    </div>
                </div>
                <div class="pull-right">

                </div>
            </div>

            <div id="store">
                {% if g_search  %}
                    {% product_list g_search %}
                {% elif search  %}
                    {% product_list search %}
                {% elif sorted_items %}
                    {% product_list sorted_items %}
                <!-- this should always come last because auctions variable is alwasys available in this context-->
                {% elif auctions %}
                    {% product_list auctions %}
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block extrajs %}
    <script src="{% static 'js/nouislider.min.js' %}"></script>
    <script>
        // PRICE SLIDER
        var slider = document.getElementById('price-slider');
        var min = 1
        var max = 100000
        if (slider) {
            noUiSlider.create(slider, {
                start: [1, 100000],
                connect: true,
                tooltips: [true, true],
                format: {
                  to: function(value) {
                      return 'N' + value.toFixed(2);
                  },
                  from: function(value) {
                      return value
                  }
                },
                range: {
                    'min': min,
                    'max': max
                }
            });
        }

    slider.noUiSlider.on('end', function(values, handle){
        var upper = $(".noUi-handle-upper .noUi-tooltip").text()
        var lower = $(".noUi-handle-lower .noUi-tooltip").text()
        var min_range_el = $("#id_min")
        var max_range_el = $("#id_max")
        min_range_el.val(lower)
        max_range_el.val(upper)
        //submit the form
{#        $("#advanced_search_price").submit()#}
    });

    </script>
{% endblock %}