{% extends "base.html" %}
{% load auction_tags %}
{% load static %}
{% load material_form %}
{% load disqus_tags %}
{% disqus_dev %}
{% load ratings %}
{% block title %}{{ auction }}{% endblock %}
{% block extrahead %}
     <link  href="{% static 'css/product_detail.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!--BBreadcrumb-->
    <ul class="breadcrumb">
      <li><a href="{% url 'pages:home' %}">Home</a></li>
      <li><a href="{% url 'auctions:list' %}">items</a></li>
      <li class="active">item detail</li>
    </ul>
    <!-- row -->
    <div class="row section">
        <div class="col-sm-7 col-md-7 white-background div-product-images box">
            <div class="row">
            <div class="col-md-2"></div>
                <div class="col-md-8">
                    <div class="row no-gutter" style="margin-top: 15px;">
                        <p style="color: #30323A; font-weight: 500;">
                                 Posted {{ auction.creator}} on {{ auction.time }}
                        </p>
                        <div class=" col-xs-4 col-sm-3 col-md-3 div-product-detail-side-images" >
                             {% for image in auction.image.all %}
                                 {% if image.image %}
                                    <div id="gallery_01">
                                        <a href="#" data-image="{{ image.image.url }}" data-zoom-image="{{ image.image.url }}">
                                            <img id="img_01" src="{{ image.image.url }}"  style="width: 50px; height: 50px; padding-bottom: 5px" alt=""/>
                                        </a>
                                    </div>
                                 {% endif %}
                             {% endfor %}
                        </div>
                        <div class="col-xs-8 col-sm-9 col-md-9 text-left div-auction-detail-image" style="margin-left: 0px">
                                {% with auction.image.all|first as first_image %}
                                    {% if first_image.image %}
                                        <img id="zoom_01" src="{{ first_image.image.url }}"
                                             class="img-responsive auction-detail-image"
                                             data-fancybox
                                             data-zoom-image="{{first_image.image.url}}"
                                        />
                                    {% else %}
                                        <img src="{% static 'images/no_image.png' %}" class="auction-detail-image img-responsive">
                                    {% endif %}
                                {% endwith %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- end of right side bar -->
    <div class="col-xs-12 col-sm-5 col-md-5 white-background box div-product-information">
        <!--/product-information-->
        <div class="product-information">
            <span style="font-size: 10px" class="rating-no-detail">
                <p>{% ratings auction 15 15 %}
                    {% if auction.creator.profile.state %}
                        <a href="" style="top: -15px !important;">posted from {{ auction.creator.profile.state }}</a>
                    {% endif %}
                </p>
            </span>

            <h3 class="subtitle">{{ auction.category }}</h3>
            <h1 class="product-name">{{ auction }}</h1>
            <h3 class="price-big">&#x20A6 {{ auction.get_current_price }}</h3>
            <p>Product ID: {{ auction.id }}</p>
            <p class="bottom-line"></p>
            <div class="prod-description">
                <div>
                    <p><b>Condition:</b> New</p>
                </div>
            </div>
            <p class="bottom-line"></p>
            {% if auction.place_on_auction %}
                <div class="container-fluid" style="margin-left: 21px;">
                    <div class="row myClock" style="padding-left: 18px; margin-bottom: -5px" data-action='{{ auction.end_time|to_json }}'>
                        <div class="row">
                            <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 days"></div>
                            <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 hours"></div>
                            <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 minutes"></div>
                            <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 seconds"></div>
                        </div>

                        <div class="row">
                            <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 counter-text">D</div>
                            <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 counter-text">H</div>
                            <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 counter-text">M</div>
                            <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 counter-text">S</div>
                        </div> <!-- counter text ends here -->
                    </div>
                </div>
            {% endif %}
            <div class="container-fluid bid-form-container row no-gutter">
                 <p>Current bid at: &#x20A6 {{ auction.get_current_price }}</p>
                {% if auction.place_on_auction %}
                     {% csrf_token %}
                        <form method="post" class="form-group">
                        {% csrf_token %}
                            <div class="row no-gutter">
                                <div class="col-xs-8 col-sm-8 col-md-8">
                                    <button class="bid-button" style="margin-left: 10px" type="submit">
                                        PLACE BID
                                    </button>
                                </div>
                            <div class="col-xs-4 col-md-4 col-sm-4 amount">
                                {{ bid_form.amount }}
                            </div>
                            </div>

                            {% if messages %}
                                <ul class="messages">
                                    <li class="error">{{ bid_form.errors }}</li>
                                    {% for message in messages %}
                                        <li class="{{ message.tags }}">{{ message|safe }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </form>
                {% endif %}
            <a href="{{ auction.creator.get_absolute_url }}">view all acution from {{ auction.creator }}</a>
            </div>
        </div><!--/product-information-->
    </div>
    <!-- end of right side bar -->
    </div><!-- row -->

    <!-- nav container -->
    <div class="section row white-background product-detail-tabs">
        <div class="col-xs-12 col-md-12" role="tabpanel"  data-example-id="togglable-tabs">
            <ul class="nav nav-tabs" role="tablist">
                <li><a  class="active" data-toggle="tab" href="#desc">Description</a></li>
                <li><a data-toggle="pill" href="#best-offers">Best Offers</a></li>
                <li><a data-toggle="pill" href="#comment">Comment</a></li>
                <li><a data-toggle="pill" href="#private-message">Private Message</a></li>
                 <li><a data-toggle="pill" href="#rate">Feedback</a></li>
            </ul>

            <div class="tab-content" style="min-height: 98px">
                <div id="desc" class="tab-pane fade in active">
                    <h4 class="text-center">Product Description</h4>
                    <div class="container-fluid text-left">{{auction.description}}</div>
                </div>

                <div id="best-offers" class="tab-pane fade">
                    <h4 class="text-center">Best Offers </h4>
                    <ul class="collection">
                        {% best_offers auction as best %}
                        {% for b in best %}
                            <li class="collection-item avatar">
                                <span class="title">{{b.amount}}</span>
                                <a href="#" class="secondary-content">
                                <i class="material-icons">grade</i>
                            </a>
                            </li>
                        {% endfor %}
                    </ul>

                </div>

                <div id="comment" class="tab-pane fade">
                    <h4 class="text-center">Drop Comment</h4>
                    <div class="container-fluid">
                        {% disqus_show_comments %}
                    </div>
                </div>

                <div id="private-message" class="tab-pane fade">
                    <div class="row">
                        <div class="col-xs-0 col-sm-2 col-md-2">

                        </div>

                        <div class="col-xs-12 col-sm-8 col-md-8">
                            {% if sent %}
                                <h4 class="text-center">Your message has been sent</h4>
                            {% else %}
                                 <h4 class="text-center">Drop a private message here</h4>
                            {% endif %}
                            <form method="post" class="form-group text-center">
                                {{ private_message.as_p }}
{#                                {%form form=private_message %}{% endform %}#}
                                 <button type="submit" name="_message" class="btn">Submit</button>
                            </form>
                        </div>

                        <div class="col-xs-0 col-sm-2 col-md-2">

                        </div>

                    </div>

                </div>

                <div id="rate" class="tab-pane fade">
                    <h4 class="text-center">Rate this item</h4>
                    <div class="container-fluid text-center">
                       {% ratings auction %}
                    </div>
                </div>
            </div> <!-- end of tab content -->
        </div>
    </div>
    <!-- nav container -->
</div> <!-- end of main container -->
    {% block extrajs %}
        <!--Elevator zoom-->
        <script src="{% static 'js/jquery.elevatezoom.js' %}" type="text/javascript"></script>
        <!-- load fancy box from CDN-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" type="text/javascript"></script>
        <script src="{% static 'js/jquery.matchHeight.js' %}" type="text/javascript"></script>
        <script>
            $('.close').click(function(){$('.messages').fadeOut(1000)})
            $("#zoom_01").elevateZoom({
                gallery: "gallery_01",
                cursor: 'pointer',
                galleryActiveClass: 'active',
                imageCrossfade: true,
                loadingIcon: 'http://www.elevateweb.co.uk/spinner.gif',
                tintOpacity:0.5,
                easing: true,
                zoomWindowWidth:400,
                zoomWindowHeight:300,
                zoomWindowOffetx: 10,
            });
            //auto match height of left sidebar and right sidebar
            $(".box").matchHeight()

            //show item owner's number when button clicked
            $(".contact").click(function(){
                var contact_button = $('.contact')
                var position = contact_button.position()
                var target = $('.phone')
                target.css('position', 'absolute', 'left', position.left, 'top', position.top)
                target.css('margin-bottom', '15px')
                contact_button.hide()
                target.css('visibility', 'visible')
                alert(position.left)
            })
        </script>
    {% endblock %}
{% endblock %}